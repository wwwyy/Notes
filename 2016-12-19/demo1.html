<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
<script type="text/javascript">
	function CreateDate(){
		this.box = document.getElementById('div1')
		this.txt = document.getElementById('tijiaoText')
	}
	CreateDate.prototype = {
		constructor:CreateDate,
		init:function(obj,event){
			var _this = this;
			obj.onclick = function(){
				_this.Event(obj);
			}
			this.loaded(1)
		},
		Event:function(){
			var _this = this;
			var val = _this.txt.value.trim();
			if (val) {
				ajax({
					url:'weibo.php',
					data:{
						act:'add',
						content:val
					},
					succ:function(json){
						if (!json.error) {
							_this.loaded(1)
							_this.txt.value = ''
						}
					}
				})
			} else {
				alert('1')
			}
		},
		cDiv:function(val,time){
			var div = document.createElement('div');
			div.className = 'replay';
			div.innerHTML =`<p class="replyContent">${val}</p>
                <p class="operation">
                    <span class="replyTime">${time}</span>
                    <span class="handle">
                    	<a href="javascript:;" class="top">0</a>
                        <a href="javascript:;" class="down_icon">0</a>
                        <a href="javascript:;" class="cut">删除</a>
                    </span>
                </p>`;
            return div;
		},
		cDate:function(time){
			var str = '';
			var t = new Date(time*1000);
			var y = t.getFullYear();
			var mon = t.getMonth()+1;
			var day = t.getDate();
			var H = t.getHours();
			var min = t.getMinutes();
			var sen = t.getSeconds()

			str = y+'-'+this.toDou(mon)+'-'+this.toDou(day)+' '+this.toDou(H)+':'+this.toDou(min)+':'+this.toDou(sen);
			return str;
		},
		toDou:function(n){
			return n<10?'0'+n:''+n;
		},
		loaded:function(n){
			var _this = this;
			ajax({
				url:'weibo.php',
				data:{
					act:'get',
					page:n
				},
				succ:function(arr){
					_this.box.innerHTML = '';
					arr.forEach(function(e,i){
						var div = _this.cDiv(e.content,_this.cDate(e.time));
						_this.box.appendChild(div)
					})
				}
			})
		}
	}
	var c1 = new CreateDate();
	var btn1 = document.getElementById('btn1');
	c1.init(btn1);
	c1.txt.onkeydown = function(ev){
		if (ev.keyCode===13 && ev.ctrlKey) {
			c1.Event()
		}
	}
</script>
</body>
</html>